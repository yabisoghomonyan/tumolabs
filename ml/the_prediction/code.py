# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/10JNstgVCfPUKZXOtRmxbdOlsb2QWl3jB
"""

from scipy import stats
from sklearn.linear_model import LinearRegression
import plotly.express as px
import pandas as pd
import numpy as np
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from sklearn.model_selection import train_test_split
import seaborn as sns
import matplotlib.pyplot as plt

df=pd.read_csv("/tumodata.csv")
df["sex"] = df["sex"].map({"Female": 0, "Male": 1})
df["smoker"]=df["smoker"].map({"No":0,"Yes":1})
df["time"]=df["time"].map({"Lunch":0,"Dinner":1})
df["day"]=df["day"].map({"Thur":0,"Fri":1,"Sat":2,"Sun":3})
for label in df.columns:
    if label != "tip":
        graf=px.scatter(df,x=label,y="tip",title=f"{label} vs tip")
        graf.show()

df=pd.read_csv("/tumodata.csv")
new_df=pd.DataFrame({"total_bill":df["total_bill"],"tip":df["tip"],"sex":df["sex"]})
df1=px.scatter(new_df,x="total_bill",y="tip",color="sex",color_discrete_map={"Female":"pink","Male":"blue"},title="total_bill vs tip")
df1.show()

fig=go.Figure()
fig=make_subplots(rows=1, cols=2)
for item in df["sex"].unique():
  if item=="Female":
    fig.add_trace(go.Histogram(x=df["tip"],name="Female",marker_color="red"),row=1,col=1)
  else:
    fig.add_trace(go.Histogram(x=df["tip"],name="Male",marker_color="blue"),row=1,col=1)
for item in df["day"].unique():
  if item=="Sun":
    fig.add_trace(go.Histogram(x=df["tip"],name="Sunday"),row=1,col=2)
  if item=="Sat":
    fig.add_trace(go.Histogram(x=df["tip"],name="Saturday"),row=1,col=2)
  if item=="Fri":
    fig.add_trace(go.Histogram(x=df["tip"],name="Friday"),row=1,col=2)
  if item=="Thur":
    fig.add_trace(go.Histogram(x=df["tip"],name="Thursday"),row=1,col=2)
fig.show()

df.drop(["sex","smoker","day","time","size"],axis=1,inplace=True)
df.head()

x_train, x_test, y_train, y_test = train_test_split(
    df["total_bill"],
    df["tip"],
    test_size=0.2,
    random_state=42,
    shuffle=True
)
dict_train = {"total_bill": x_train.values,"tip": y_train.values,"Data":"Training"}
df_train= pd.DataFrame(dict_train)
dict_test={"total_bill":x_test.values,"tip":y_test.values,"Data":"Testing"}
df_test = pd.DataFrame(dict_test)
df_all = pd.concat([df_train, df_test], ignore_index=True)

fig=go.Figure()
mymodel=LinearRegression()
mymodel.fit(x_train.values.reshape(-1,1),y_train.values.reshape(-1,1))
fig=px.scatter(df_all,
                  x="total_bill",
                  y="tip",
                  color="Data",
                  color_discrete_map={"Testing": "red", "Training": "blue"},
                  size='tip',hover_data=['tip'],
               title="Lineral regretion")
y_pred=mymodel.predict(x_train.values.reshape(-1,1))
fig.add_trace(go.Scatter(
    x=x_train.values.flatten(),
    y=y_pred.flatten(),
    mode='lines',
    name='Regression Line',
    line=dict(color='orange')))
slope, intercept, r, p, Standard_Error = stats.linregress(x_train, y_train)
def myfunc(x):
  return slope * x + intercept
fig.show()

print(myfunc(10.5))

myscore = mymodel.score(x_test.values.reshape(-1,1), y_test)
print(f"r2 score{myscore}")
mypredict = mymodel.predict(x_test.values.reshape(-1,1))
print(mypredict)

df=pd.read_csv("tumodata.csv")
counts, bin_edges = np.histogram(df.total_bill, bins=5)
label=[f"{bin_edges[i]}-{bin_edges[i+1]} $" for i in range(len(counts))]
new_df=pd.DataFrame({"count":counts,"label":label})
fig=px.pie(new_df,values="count",names="label",title="Total bill",hole=.4)
fig.show()
df=px.pie(df,names="day",title="Day",hole=0.4)
df.show()

df=pd.read_csv("tumodata.csv")
df["sex"] = df["sex"].map({"Female": 0, "Male": 1})
df["smoker"]=df["smoker"].map({"No":0,"Yes":1})
df["time"]=df["time"].map({"Lunch":0,"Dinner":1})
df["day"]=df["day"].map({"Thur":0,"Fri":1,"Sat":2,"Sun":3})
matrix = df.corr(numeric_only=True)
fig = px.imshow(matrix,
                x=matrix.columns,
                y=matrix.index,
                color_continuous_scale='RdBu_r',
                text_auto='.2f',
                aspect="auto"
               )
fig.update_layout(
    title='Correlation Matrix',
    xaxis_showgrid=False,
    yaxis_showgrid=False,
    width=1000,
    height=1000,
)